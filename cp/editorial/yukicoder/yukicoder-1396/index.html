<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ9N5F5QDD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QZ9N5F5QDD")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>yukicoder No. 1306 - Exactly 2 Digits 解説 &ndash; Growth Record of Lettuce Farm: Extended
</title><meta name=description property="og:description" content="yukicoder Advent Calendar Contest 2020 の 12/03 出題問題です。 教育的問題除く ★4 初 AC！(★3.5 の AC が無いのは内緒) ちなみに 16 番目の AC でした。時間はかかったけれど、高難易度の問題をじっくり攻略するのは楽…|れたすのブログ"><meta name=apple-mobile-web-app-title content="Growth Record of Lettuce Farm: Extended"><link rel=icon href=https://blog.fairy-lettuce.com/favicon-64.png><link rel=apple-touch-icon href=https://blog.fairy-lettuce.com/apple-touch-icon.png><link rel=mask-icon size=any href=https://blog.fairy-lettuce.com/pinned-icon.svg><meta name=twitter:card content="summary"><meta name=twitter:site content="@fairy_lettuce"><meta name=twitter:creator content="@fairy_lettuce"><meta name=twitter:title content="yukicoder No. 1306 - Exactly 2 Digits 解説 | Growth Record of Lettuce Farm: Extended"><meta name=twitter:description content="yukicoder Advent Calendar Contest 2020 の 12/03 出題問題です。 教育的問題除く ★4 初 AC！(★3.5 の AC が無いのは内緒) ちなみに 16 番目の AC でした。時間はかかったけれど、高難易度の問題をじっくり攻略するのは楽…|れたすのブログ"><meta name=twitter:image content="https://blog.fairy-lettuce.com/twitter-card.png"><link rel=stylesheet href=/assets/syntax.css><link rel=stylesheet href=/assets/primer-build.css><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/custom_style.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://blog.fairy-lettuce.com/>Growth Record of Lettuce Farm: Extended</a><div class=UnderlineNav-body><a class=UnderlineNav-item href=/about><i class='fa fa-about'></i>
<span>About</span>
</a><a class=UnderlineNav-item href=/diary><i class='fa fa-diary'></i>
<span>Diary</span>
</a><a class=UnderlineNav-item href=/cp><i class='fa fa-cp'></i>
<span>Competitive</span>
</a><a class=UnderlineNav-item href=/game><i class='fa fa-cp'></i>
<span>Game</span>
</a><a class=UnderlineNav-item href=/links><i class='fa fa-diary-old'></i>
<span>Links</span>
</a><a class=UnderlineNav-item href=https://github.com/fairy-lettuce><i class='fa fa-github'></i>
<span>GitHub</span></a></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">yukicoder No. 1306 - Exactly 2 Digits 解説</div></div><div class=Subhead-description><a href=/categories/%E7%AB%B6%E3%83%97%E3%83%AD%E8%A7%A3%E8%AA%AC class=muted-link><span class="Label Label--gray-darker">競プロ解説</span>
</a><a href=/categories/yukicoder class=muted-link><span class="Label Label--gray-darker">yukicoder</span>
</a><a href=/tags/competitive class=muted-link><span class="Label Label--gray">Competitive</span></a><div class=float-md-right><span title="Lastmod: 2020-12-03. Published at: 2020-12-03.">Published: 2020-12-03</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><p><a href=https://yukicoder.me/contests/300>yukicoder Advent Calendar Contest 2020</a> の 12/03 出題問題です。</p><p>教育的問題除く ★4 初 AC！(★3.5 の AC が無いのは内緒) ちなみに 16 番目の AC でした。時間はかかったけれど、高難易度の問題をじっくり攻略するのは楽しいです。</p><p>おことわりですが、問題を解いた後ぼーっとしながら思考をそのまま書き連ねているので、解説の体を成していないかもしれません(ごめんなさい)。「考察」の内容は解説というよりは私の思考手順をなるべく細かく文章にしたものです。解説記事については、「私と同じ知識を有する人が同じ問題が全く分からなかった際に見て思考を追える文章」をモットーにしているので、いささか回りくどいかもしれません。その代わり、「解法」パートは簡潔に解き方をまとめようと思うので、どうかご容赦ください。<br>解説をどれくらいの細かさで書くかは本当に人々の思想だと思うんですけれど(ABC の解説を見ているとよく分かります……)、どうしたらいいんでしょうか……。</p><h2 id=問題リンク>問題リンク</h2><p><a href=https://yukicoder.me/problems/no/1306>https://yukicoder.me/problems/no/1306</a></p><h2 id=問題概要>問題概要</h2><p>インタラクティブ数当てゲーム。</p><p>$\{N,\ N+1,\ \dots ,\ N^2 -1\}$ をちょうど $1$ つずつ含む順列 $A$ があります。この順列を以下のクエリを高々 $1.5\times(N^2-N)$ 回行うことで特定してください。</p><ul><li><code>? i j</code><ol><li>$p=\lfloor A_i/N\rfloor-\lfloor A_j/N\rfloor$ とする。つまり、$A_i,\ A_j$ の $N$ の位の差。</li><li>$q=\lfloor A_i%N\rfloor-\lfloor A_j%N\rfloor$ とする。つまり、$A_i,\ A_j$ の $1$ の位の差。</li><li>もし $p\lt q$ なら $p,\ q$ を swap する。</li><li>$p,\ q$ が返される。</li></ol></li></ul><p>数列を特定したら、<code>!</code> に続けて数列を出力してください。</p><p>ただし、<b>出力したクエリによって完全に数列を特定できることができない状態で数列を答えても AC とはなりません</b>(adaptive なジャッジ)。</p><h2 id=制約>制約</h2><p>$2\le N\le 50$</p><h2 id=考察>考察</h2><p>$N$ の小さいときを考察します。$N=2$ とします。このとき、ありえる数列は $(2, 3),\ (3,\ 2)$ のどちらかです。ここでサンプル同様に <code>? 2 1</code> のクエリを出力すると、それぞれ <code>0 1</code> と <code>-1 0</code> が帰ってきます。よって、$N=2$ のときはこれで十分特定できます。</p><p>$N=3$ のときです。ありえる数列は $\{3,\ 4,\ 5,\ 6,\ 7,\ 8\}$ の順列全てです。ここでは $(6,\ 5,\ 8,\ 7,\ 3,\ 4)$ を例に取ってみます。なお、$A_1=6=3\times 2+0$ であることに注意してください。<br>$2$ 個の数列の要素についての質問をできるタイプのインタラクティブ数列当てゲームの定石ですが、$1$ 個目を固定して他のものとの質問をします<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。すると、クエリ <code>? 1 i</code> $i=1,\ 2,\ 3,\ \dots$ の結果 $(p,\ q)$ はそれぞれ次のようになるはずです(便宜上 $i=1$ のクエリも含めていますが実際には質問しなくても問題ありません。また、以下では説明のため $(p, q)$ の順序はここでは変えずに<u>下線</u>を引くだけにしています)。</p><p>$(0,\ 0),\ (-1,\ 2),\ (0,\ 2),\ (0,\ 1),\ (-1,\ 0),\ (-1,\ 1)$</p><p>この結果から $A_1$ を復元できないか試みます。<br>$(p,\ q)$ の順序を変えていないため $N,\ 1$ の位の差が何回ずつ現れているかを見てみます。すると、$N$ の位の差には $-1,\ 0$ がそれぞれ $3$ 個、$1$ の位の差には $0,\ 1,\ 2$ がそれぞれ $2$ 個ずつ現れていると分かります。<br>両者で現れる値の範囲は $A_1$ の各位の値に依存していると考えられます。それでは、他の $A_1$ の値のときにそれぞれの範囲と現れる回数がどう動くかを確かめてみることにします。</p><figure class="figure-image figure-image-fotolife" title="図 1"><a href=https://f.hatena.ne.jp/fairy_lettuce/20201203040821><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/f/fairy_lettuce/20201203/20201203040821.png alt=20201203040821></a><figcaption>図 1</figcaption></figure><p>上のようになります。さらに一般の $N$ についても同様に考えると、</p><figure class="figure-image figure-image-fotolife" title="図 2"><a href=https://f.hatena.ne.jp/fairy_lettuce/20201203041730><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/f/fairy_lettuce/20201203/20201203041730.png alt=20201203041730></a><figcaption>図 2</figcaption></figure><p>このようになります。<br>これより、それぞれの値の登場する回数は合計して $N-1,\ N,\ 2N-1$ のどれかであるため、それぞれの区間がどこにあるのかが分かります。これより $A_1$ は特定できます。</p><p>$A_1$ が特定できたらあとは得られた各 $(p,\ q)$ を手がかりに $A_i$ を復元することを考えます。<br>先程の例 $(6,\ 5,\ 8,\ 7,\ 3,\ 4)$ では $(p,\ q)$ の逆転した箇所は無いため、容易に復元できます。しかし、例えば $(3,\ 4,\ 5,\ 6,\ 7,\ 8)$ のような場合はどうなるでしょうか。</p><p>$(0,\ 0),\ (0,\ 1),\ (0,\ 2),\ \underline{(1,\ 0)},\ (1,\ 1),\ (1,\ 2)$</p><p>この場合は逆転したクエリが生まれています。そして、あろうことか逆転したあとの $(p,\ q)$ において $(0,\ 1)$ が $2$ つ存在しています。これでは区別ができないので、何か別のクエリで区別できないかを考えます。</p><p>$(p,\ q)$ は順序が区別できない状態で返されるため、$(p,\ q)$ が同じになってしまったふたつに関してクエリを質問することは無意味です。そこで、他の値と比較することで決定できないでしょうか。<br>ここで、$i,\ j$ に関しての $(p_i,\ q_i),\ (p_j,\ q_j)$ が同じ値になってしまう $i,\ j$ は、$(p_i,\ q_i)=(q_j,\ p_j)$ となる場合です。$N=3$ のときについて例示すると、そのような $i,\ j$ の組は下の図で太線となっているものの組の $1$ 通りです(下図では辺が $(p,\ q)$ の組に対応していることに注意してください)。</p><figure class="figure-image figure-image-fotolife" title="図 3"><a href=https://f.hatena.ne.jp/fairy_lettuce/20201203043149><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/f/fairy_lettuce/20201203/20201203043149.jpg alt=20201203043149></a><figcaption>図 3</figcaption></figure><p>より一般的には、$p,\ q$ で現れる数の区間が被っている個数が $k$ 個であるとき、$k(k-1)/2$ 個の区別できない $(p,\ q)$ が存在します。$k$ は最大でも $N-1$ であるため、それぞれの区別できない箇所について $1$ 回ずつのクエリでどちらがどちらかを当てる作戦で行きましょう。</p><p>ところで、最初に見た例 $(6,\ 5,\ 8,\ 7,\ 3,\ 4)$ では $(p,\ q)$ の反転はありませんでした。そこで、先程の図 1 で $6$、つまり $A_1$ の $N$ の位が $2$、$1$ の位が $0$ のときを見てみると、それぞれの区間の重なりは $0$ のひとつのみです。このときは区別できない $(p,\ q)$ の組は $0$ です。<br>更に一般に、$A_1$ の $N,\ 1$ の位がそれぞれ $1, N-1$ または $N-1,\ 0$ であるとき、$A_1$ と他の数のクエリの答え $(p,\ q)$ は必ず区別できます。</p><p>ということで、そのどちらかを新しい基準にすれば両者を区別できるということになります。今回は私が通した際に使ったほうである $N,\ 1$ の位がそれぞれ $1,\ N-1$ であるときを考えます。<br>図 2 を眺めてもらえば分かると思いますが、$A_i$ の各位が $1,\ N-1$ のとき(それぞれ区間の左端と右端に対応します)は必ずしも区別できる領域にあるわけではありません(例: $A_1$ の各位が $N-1,\ N-1$ のとき)。そこで、$A_i$ が特定できなかった場合は、どのような $A_1$ であっても常に $(p,\ q)$ が区別できるもの、具体的には $A_i=N$ (各位は $1,\ 0$) を持ってきます(常に区別できることは容易に確かめられます)。<br>各位が $1,\ N-1$ である候補のどちらか片方について、それと各位が $1,\ 0$ である数のクエリで得られた $(p,\ q)$ は、それが予想通りの結果であればそれはその場所で合っていて、予想と違えば逆である、という判断材料になります。</p><p>これで判断基準となる軸の数が決定できました。あとは、軸の決定時と同じやり方で区別できないペアを全て決定していけば答えに辿り着けます。</p><h2 id=解法>解法</h2><p>段階に分けて説明します。</p><h3 id=a_1-と他を全部比較する-クエリ-nn-1-1-回>$A_1$ と他を全部比較する (クエリ: $N(N-1)-1$ 回)</h3><p>$A_1$ と $A_i\ (i=2,\ 3,\ \dots)$ を比較し、$(p,\ q)$ を保存しておきます。$(p,\ q)$ の逆引きを持っておくと嬉しいかもしれません。<br>$p,\ q$ 全て合計で現れた回数も記録しておき、そこから $A_1$ の $N,\ 1$ の位を復元できます(図 2 参照)。</p><h3 id=n-である要素を探す-クエリ-0-回>$N$ である要素を探す (クエリ: $0$ 回)</h3><p>$N$ である要素は $(p,\ q)$ がどちらも現れる中で最小であるペアである要素です。これより、$N$ の場所を特定します。</p><h3 id=nn-1-である要素を探す-クエリ-0-1-回>$N+(N-1)$ である要素を探す (クエリ: $0,\ 1$ 回)</h3><p>もし一意に定まっている場合は次に進みます。<br>定まっていない、つまり $(p,\ q)$ がそれと同じものになる要素がもう一つある場合は、$A_1,\ N+(N-1)$ についてのクエリを投げたときに帰ってくると予想される $(p,\ q)$ と同じものがどちらであるかで $N+(N-1)$ が特定できます。</p><h3 id=p-q-が区別できない組全てを特定する-クエリ-最大-n-1n-22-回>$(p,\ q)$ が区別できない組全てを特定する (クエリ: 最大 $(N-1)(N-2)/2$ 回)</h3><p>特定した $N+(N-1)$ と区別できない要素 $A_i,\ A_j$ のどちらか(ここでは $A_i$ に投げるとする)についてクエリを投げます。それが $N+(N-1),\ A_i$ についてのクエリを投げたときに帰ってくると予想される $(p,\ q)$ と同じものがどちらかであるかで $A_i,\ A_j$ が特定できます。</p><p>以上で答えです。クエリの総数は $1.5\times N(N-1)/2$ を越えません。</p><h2 id=実装>実装</h2><p>ちなみにですが、<code>Ask()</code> メソッドについて、私は <code>? i j</code> が返すものを<b>逆だと勘違い</b>していて、$N=2$ のケースすらも WA になってしまっていました。何故か本当に分からなくて、$N=2$ のみ通るサンプル通りのものを投げたらそのケースのみ AC したところで、ようやく気付きました。気付くまでは手元で色々なケースを試しデバッグしていたのでそこを直したら一発 AC。ちなみに AC までにかかった submit 数は驚きの 12 回。<br><b>絶対落ちるはずのないテストケースすら通らないときは根本的なミスが無いか確認しましょう</b>。あと問題文を読みましょう。最近とても注意力が落ちています……。これが Rated じゃなくてよかった……。</p><p>今回は本当にぐちゃぐちゃコードです。ゴリ押ししました。</p><details><summary><u><b>実装を展開する</b></u></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Solve(Scanner cin)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> n = cin.ReadInt();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> all = n * n - n;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>//var a = cin.ReadIntArray(all);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span>[] a = <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> ans = SolveCheck(n, all, a, cin);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (a != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; all; i++)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (a[i] != ans[i])
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						Console.WriteLine(<span style=color:#e6db74>&#34;Assertion Failed!&#34;</span>);
</span></span><span style=display:flex><span>						Console.WriteLine(<span style=color:#e6db74>$&#34;n: {n}&#34;</span>);
</span></span><span style=display:flex><span>						Console.WriteLine(<span style=color:#e6db74>$&#34;a: {a.Join(&#34;</span> <span style=color:#e6db74>&#34;)}&#34;</span>);
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span>[] SolveCheck(<span style=color:#66d9ef>int</span> n, <span style=color:#66d9ef>int</span> all, <span style=color:#66d9ef>int</span>[] a, Scanner cin)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span> timesAsked = <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// if the return value is P, then ret[P + n] increments</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> ret = <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span>[n * <span style=color:#ae81ff>2</span> + <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>			<span style=color:#75715e>// the answers of the queries</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> qa = <span style=color:#66d9ef>new</span> (<span style=color:#66d9ef>int</span> p, <span style=color:#66d9ef>int</span> q)[all];
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> dic = <span style=color:#66d9ef>new</span> SortedDictionary&lt;(<span style=color:#66d9ef>int</span> p, <span style=color:#66d9ef>int</span> q), List&lt;<span style=color:#66d9ef>int</span>&gt;&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			ret[n] += <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>			dic.Add((<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), <span style=color:#66d9ef>new</span> List&lt;<span style=color:#66d9ef>int</span>&gt;());
</span></span><span style=display:flex><span>			dic[(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>)].Add(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>1</span>; i &lt; all; i++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				timesAsked++;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (timesAsked &gt; all * <span style=color:#ae81ff>3</span> / <span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Exception();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> (p, q) = Ask(<span style=color:#ae81ff>0</span>, i, cin, a, n);
</span></span><span style=display:flex><span>				qa[i] = (p, q);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (!dic.ContainsKey((p, q))) dic.Add((p, q), <span style=color:#66d9ef>new</span> List&lt;<span style=color:#66d9ef>int</span>&gt;());
</span></span><span style=display:flex><span>				dic[(p, q)].Add(i);
</span></span><span style=display:flex><span>				ret[p + n]++;
</span></span><span style=display:flex><span>				ret[q + n]++;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>bool</span> isBigDigit = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>bool</span> isSmallDigit = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span> leftBigDigit = -<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span> rightBigDigit = -<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span> leftSmallDigit = -<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span> rightSmallDigit = -<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; n * <span style=color:#ae81ff>2</span> + <span style=color:#ae81ff>1</span>; i++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (ret[i] == n || ret[i] == <span style=color:#ae81ff>2</span> * n - <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (!isBigDigit) leftBigDigit = i - n;
</span></span><span style=display:flex><span>					isBigDigit = <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (isBigDigit) rightBigDigit = i - n;
</span></span><span style=display:flex><span>					isBigDigit = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (ret[i] == n - <span style=color:#ae81ff>1</span> || ret[i] == <span style=color:#ae81ff>2</span> * n - <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (!isSmallDigit) leftSmallDigit = i - n;
</span></span><span style=display:flex><span>					isSmallDigit = <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (isSmallDigit) rightSmallDigit = i - n;
</span></span><span style=display:flex><span>					isSmallDigit = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			Debug.Assert(rightBigDigit - leftBigDigit == n - <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>			Debug.Assert(rightSmallDigit - leftSmallDigit == n);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> ans = <span style=color:#66d9ef>new</span> (<span style=color:#66d9ef>int</span> big, <span style=color:#66d9ef>int</span> small)[all];
</span></span><span style=display:flex><span>			ans[<span style=color:#ae81ff>0</span>] = (<span style=color:#ae81ff>1</span> - leftBigDigit, -leftSmallDigit);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> oneZeroPair = (leftBigDigit, leftSmallDigit);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (leftBigDigit &gt; leftSmallDigit) oneZeroPair = (leftSmallDigit, leftBigDigit);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> oneZero = dic[oneZeroPair][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>			Debug.Assert(dic[oneZeroPair].Count == <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> zeroMaxPair = (big: leftBigDigit, small: rightSmallDigit - <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (leftBigDigit &gt; rightSmallDigit - <span style=color:#ae81ff>1</span>) zeroMaxPair = (rightSmallDigit - <span style=color:#ae81ff>1</span>, leftBigDigit);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> zeroMax = dic[zeroMaxPair][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (dic[zeroMaxPair].Count &gt;= <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> revMaxZeroPair = (zeroMaxPair.small, zeroMaxPair.big);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> genuine = (big: rightBigDigit - <span style=color:#ae81ff>1</span>, small: leftSmallDigit);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> fake = (big: leftSmallDigit, small: rightBigDigit - <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> first = dic[zeroMaxPair][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> second = dic[zeroMaxPair][<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> expected = (<span style=color:#ae81ff>0</span>, n - <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>				timesAsked++;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (timesAsked &gt; all * <span style=color:#ae81ff>3</span> / <span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Exception();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> check = Ask(oneZero, first, cin, a, n);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (expected == check)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					zeroMax = first;
</span></span><span style=display:flex><span>					qa[first] = genuine;
</span></span><span style=display:flex><span>					qa[second] = fake;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					zeroMax = second;
</span></span><span style=display:flex><span>					qa[first] = fake;
</span></span><span style=display:flex><span>					qa[second] = genuine;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> e <span style=color:#66d9ef>in</span> dic)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (e.Value.Count &gt;= <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>var</span> genuine = e.Key;
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>var</span> fake = (p: e.Key.q, q: e.Key.p);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>var</span> expected = (big: ans[<span style=color:#ae81ff>0</span>].big + genuine.p - <span style=color:#ae81ff>1</span>, small: ans[<span style=color:#ae81ff>0</span>].small + genuine.q - (n - <span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (expected.big &gt; expected.small)
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>var</span> t = expected.big;
</span></span><span style=display:flex><span>						expected.big = expected.small;
</span></span><span style=display:flex><span>						expected.small = t;
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>					timesAsked++;
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (timesAsked &gt; all * <span style=color:#ae81ff>3</span> / <span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Exception();
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>var</span> check = Ask(zeroMax, e.Value[<span style=color:#ae81ff>0</span>], cin, a, n);
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (expected == check)
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						qa[dic[e.Key][<span style=color:#ae81ff>0</span>]] = genuine;
</span></span><span style=display:flex><span>						qa[dic[e.Key][<span style=color:#ae81ff>1</span>]] = fake;
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						qa[dic[e.Key][<span style=color:#ae81ff>0</span>]] = fake;
</span></span><span style=display:flex><span>						qa[dic[e.Key][<span style=color:#ae81ff>1</span>]] = genuine;
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; all; i++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> (p, q) = qa[i];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (leftBigDigit &lt;= p &amp;&amp; p &lt; rightBigDigit &amp;&amp; leftSmallDigit &lt;= q &amp;&amp; q &lt; rightSmallDigit)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#75715e>// do nothing</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>var</span> t = p;
</span></span><span style=display:flex><span>					p = q;
</span></span><span style=display:flex><span>					q = t;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				ans[i] = (ans[<span style=color:#ae81ff>0</span>].big + p, ans[<span style=color:#ae81ff>0</span>].small + q);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> answer = ans.Select(p =&gt; p.big * n + p.small).ToArray();
</span></span><span style=display:flex><span>			Answer(answer);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> answer;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> (<span style=color:#66d9ef>int</span> p, <span style=color:#66d9ef>int</span> q) Ask(<span style=color:#66d9ef>int</span> i, <span style=color:#66d9ef>int</span> j, Scanner cin, <span style=color:#66d9ef>int</span>[] ans, <span style=color:#66d9ef>int</span> n)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (ans == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				Console.WriteLine(<span style=color:#e6db74>$&#34;? {j + 1} {i + 1}&#34;</span>);
</span></span><span style=display:flex><span>				Console.Out.Flush();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> (p, q) = cin.ReadValue&lt;<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>&gt;();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> (p, q);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				Console.WriteLine(<span style=color:#e6db74>$&#34;? {j + 1} {i + 1}&#34;</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> p = ans[j] / n - ans[i] / n;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> q = ans[j] % n - ans[i] % n;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (p &gt; q)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>var</span> t = p;
</span></span><span style=display:flex><span>					p = q;
</span></span><span style=display:flex><span>					q = t;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				Console.WriteLine(<span style=color:#e6db74>$&#34;\t{p} {q}&#34;</span>);
</span></span><span style=display:flex><span>				Console.Out.Flush();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> (p, q);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Answer(IEnumerable&lt;<span style=color:#66d9ef>int</span>&gt; a)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			Console.WriteLine(<span style=color:#e6db74>$&#34;! {a.Join(&#34;</span> <span style=color:#e6db74>&#34;)}&#34;</span>);
</span></span><span style=display:flex><span>			Console.Out.Flush();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div></details><p>ACコード: <a href=https://yukicoder.me/submissions/588549>https://yukicoder.me/submissions/588549</a></p><h2 id=感想>感想</h2><p>やっぱり数当てインタラクティブほど面白い競プロの問題はないです。この問題も考えているときは、なぜ通らないかウンウン悩みながらもずっと楽しかったです。Ad-hoc、最高！</p><p>それはそうと、日本語で上手く伝えるのって難しいです。考察パートは数学的に厳密な書き方を必ずしもせず感覚的な書き方を多くしていると思いますが、それが仇となり文章が読みにくくなることもあるので、うまい落とし所を見つけられるようになりたいです。<br>短時間で質の良く分かりやすい解説を書けるようになりたいですね。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>この 1 ヶ月で解いたインタラクティブ数列当てゲーム、これで 3 問目なので、流石に一瞬で方針は立ちました。これが経験っていうものですね。たくさん問題を解くことの大切さを思い知りました。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><section></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=author class="Box mb-3 mt-3 p-2 text-center"><a href=/about><img class=m-1 src=/icon-round.png alt=プロフィール画像 width=120 height=120></a><p class="text-emphasized f3">れたす</p><p>遊んだこと・学んだことをまとめる個人ブログ</p><a href=https://twitter.com/fairy_lettuce>Twitter</a></div><div id=toc class="Box Box--blue mb-3"><b>yukicoder No. 1306 - Exactly 2 Digits 解説</b><nav id=TableOfContents><ul><li><a href=#問題リンク>問題リンク</a></li><li><a href=#問題概要>問題概要</a></li><li><a href=#制約>制約</a></li><li><a href=#考察>考察</a></li><li><a href=#解法>解法</a><ul><li><a href=#a_1-と他を全部比較する-クエリ-nn-1-1-回>$A_1$ と他を全部比較する (クエリ: $N(N-1)-1$ 回)</a></li><li><a href=#n-である要素を探す-クエリ-0-回>$N$ である要素を探す (クエリ: $0$ 回)</a></li><li><a href=#nn-1-である要素を探す-クエリ-0-1-回>$N+(N-1)$ である要素を探す (クエリ: $0,\ 1$ 回)</a></li><li><a href=#p-q-が区別できない組全てを特定する-クエリ-最大-n-1n-22-回>$(p,\ q)$ が区別できない組全てを特定する (クエリ: 最大 $(N-1)(N-2)/2$ 回)</a></li></ul></li><li><a href=#実装>実装</a></li><li><a href=#感想>感想</a></li></ul></nav></div><div><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-show-count=false>Tweet</a><script async src=https://platform.twitter.com/widgets.js></script>
<iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button&size=small&mobile_iframe=true&width=61&height=20&appId" width=61 height=20 style=border:none;overflow:hidden scrolling=no frameborder=0 allowtransparency=true allow=encrypted-media></iframe>
<a href=http://b.hatena.ne.jp/entry/ class=hatena-bookmark-button data-hatena-bookmark-layout=basic-label-counter data-hatena-bookmark-lang=ja title=このエントリーをはてなブックマークに追加><img src=https://b.st-hatena.com/images/entry-button/button-only@2x.png alt=このエントリーをはてなブックマークに追加 width=20 height=20 style=border:none></a><script type=text/javascript src=https://b.st-hatena.com/js/bookmark_button.js async></script>
<a data-pocket-label=pocket data-pocket-count=none class=pocket-btn data-lang=en></a><script type=text/javascript>!function(e,t){if(!e.getElementById(t)){var s,n=e.createElement("script");n.id=t,n.src="https://widgets.getpocket.com/v1/j/btn.js?v=1",s=e.getElementById(t),e.body.appendChild(n)}}(document,"pocket-btn-js")</script></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"><span class="text-small text-gray">©fairy-lettuce 2023 &#183;
Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</span></div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script></body></html>