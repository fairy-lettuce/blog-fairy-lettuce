<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ9N5F5QDD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QZ9N5F5QDD")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>AtCoder Regular Contest 129 D - -1+2-1 解説 (エスパー→証明) &ndash; Growth Record of Lettuce Farm: Extended</title><meta name=description property="og:description" content="エスパーです。正直こっちのほうが分かりやすいです。 厳密ではありませんが証明はちゃんとつけました。 問題リンク https://atcoder.jp/contests/arc129/tasks/arc129_d 問題概要 長さ の整数列 があります。この整数列の両端は繋がっていま…|れたすのブログ"><meta name=apple-mobile-web-app-title content="Growth Record of Lettuce Farm: Extended"><link rel=icon href=https://blog.fairy-lettuce.com/favicon-64.png><link rel=apple-touch-icon href=https://blog.fairy-lettuce.com/apple-touch-icon.png><link rel=mask-icon size=any href=https://blog.fairy-lettuce.com/pinned-icon.svg><meta name=twitter:card content="summary"><meta name=twitter:site content="@fairy_lettuce"><meta name=twitter:creator content="@fairy_lettuce"><meta name=twitter:title content="AtCoder Regular Contest 129 D - -1+2-1 解説 (エスパー→証明) | Growth Record of Lettuce Farm: Extended"><meta name=twitter:description content="エスパーです。正直こっちのほうが分かりやすいです。 厳密ではありませんが証明はちゃんとつけました。 問題リンク https://atcoder.jp/contests/arc129/tasks/arc129_d 問題概要 長さ の整数列 があります。この整数列の両端は繋がっていま…|れたすのブログ"><meta name=twitter:image content="https://blog.fairy-lettuce.com/twitter-card.png"><link rel=stylesheet href=/assets/syntax.css><link rel=stylesheet href=/assets/primer-build.css><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/custom_style.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://blog.fairy-lettuce.com/>Growth Record of Lettuce Farm: Extended</a><div class=UnderlineNav-body><a class=UnderlineNav-item href=/about><i class='fa fa-about'></i>
<span>About</span>
</a><a class=UnderlineNav-item href=/diary><i class='fa fa-diary'></i>
<span>Diary</span>
</a><a class=UnderlineNav-item href=/cp><i class='fa fa-cp'></i>
<span>Competitive</span>
</a><a class=UnderlineNav-item href=/game><i class='fa fa-cp'></i>
<span>Game</span>
</a><a class=UnderlineNav-item href=/links><i class='fa fa-diary-old'></i>
<span>Links</span>
</a><a class=UnderlineNav-item href=https://github.com/fairy-lettuce><i class='fa fa-github'></i>
<span>GitHub</span></a></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">AtCoder Regular Contest 129 D - -1+2-1 解説 (エスパー→証明)</div></div><div class=Subhead-description><a href=/categories/%E7%AB%B6%E3%83%97%E3%83%AD%E8%A7%A3%E8%AA%AC class=muted-link><span class="Label Label--gray-darker">競プロ解説</span>
</a><a href=/categories/atcoder class=muted-link><span class="Label Label--gray-darker">AtCoder</span>
</a><a href=/tags/competitive class=muted-link><span class="Label Label--gray">Competitive</span></a><div class=float-md-right><span title="Lastmod: 2022-12-20. Published at: 2022-12-20.">Published: 2022-12-20</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><p>エスパーです。正直<a href=https://kmjp.hatenablog.jp/entry/2021/12/19/0900>こっち</a>のほうが分かりやすいです。</p><p>厳密ではありませんが証明はちゃんとつけました。</p><h2 id=問題リンク>問題リンク</h2><p><a href=https://atcoder.jp/contests/arc129/tasks/arc129_d>https://atcoder.jp/contests/arc129/tasks/arc129_d</a></p><h2 id=問題概要>問題概要</h2><p>長さ $N$ の整数列 $(A_1, \dots, A_N)$ があります。この整数列の両端は繋がっています。</p><p>$A_{i-1}, A_i, A_{i+1}$ にそれぞれ $-1,2,-1$ を何回か足すことによって $A_i$ を全て $0$ にできるか判定し、できるなら最小回数を求めて下さい。</p><h2 id=制約>制約</h2><ul><li>$3\le N\le 200000$</li><li>$-100\le A_i \le 100$</li><li>入力は全て整数</li></ul><h2 id=考察>考察</h2><p><span style=color:#999><s>今回は自分の解法を解説するので kmjp さんの解説と同じ内容は省きます。</s></span></p><p>行列を考えます。$i$ を選ぶ回数を $x_i$ とおくと、次のような関係が成り立ちます。</p><p>$\boldsymbol{A}=\boldsymbol{P}\boldsymbol{x}$</p><p>ただし、$\boldsymbol{A}=(A_1, A_2, \dots, A_N)^\top,\boldsymbol{x}=(x_1, x_2, \dots, x_N)^\top$。また、$\boldsymbol{P}$ は</p><p>\begin{pmatrix} -2 & 1 & 0 & \cdots & 0 & 1 \\ 1 & -2 & 1 & \cdots & 0 & 0 \\ 0 & 1 & -2 & \cdots & 0 & 0 \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 0 & 0 & 0 & \cdots & -2 & 1 \\ 1 & 0 & 0 & \cdots & 1 & -2 \\ \end{pmatrix}</p><p>ここで、$\boldsymbol{P}$ の rank を調べると $N-1$ となります。つまり、$N-1$ 個の $x_i$ を決めれば残りの $1$ 個も決まります。</p><p>よって、適当な主小行列 (行列の $i$ 行目と $i$ 列目を同時になくした行列) の逆行列を考えたら上手に $x_i$ の値が決まりそうな雰囲気がします。</p><p>一方、設定から自明に $\sum A_i=0$ なので、rank が $N-1$ であることに由来する制約条件も分かるので、これは妥当な考察であることが分かります。</p><h2 id=解法>解法</h2><p>先述の行列 $\boldsymbol{P}$ のうち $N$ 行目 $N$ 列目を取り除いた主小行列を $\boldsymbol{P&rsquo;}$ とおきます。つまり、</p><p>\begin{pmatrix} -2 & 1 & 0 & \cdots & 0 \\ 1 & -2 & 1 & \cdots & 0 \\ 0 & 1 & -2 & \cdots & 0 \\ \vdots & \vdots & \vdots & \ddots & \vdots \\ 0 & 0 & 0 & \cdots & -2 \\ \end{pmatrix}</p><p>です。また $\boldsymbol{A}, \boldsymbol{x}$ の第 $N$ 成分をなくしたものを $\boldsymbol{A&rsquo;}, \boldsymbol{x&rsquo;}$ とおきます。</p><p>$\boldsymbol{P}$ の rank は $N-1$ なので、$\boldsymbol{P&rsquo;}$ は逆行列を持ち、$\boldsymbol{A&rsquo;}$ が決まれば $\boldsymbol{x&rsquo;}$ も一意に決まります。また、$\boldsymbol{x&rsquo;}$ が定まれば連立方程式の適当などれか (例えば $x_N-2x_1+x_2=a_1$) を用いることで $x_N$ も定まります。</p><p>さて、$\boldsymbol{P&rsquo;}^{-1}$ ですが、Wolfram Alpha に入れると次のようになります。これから、$(i, j)$ 成分 $(i\le j)$ が $\frac{-1}{N} i(N-j)$ である対称行列、つまり $(i, j)$ 成分は一般に $\frac{-1}{N} \min(i,j)(N-\max(i,j))$ である対称行列となることが推測されます。</p><a href=https://f.hatena.ne.jp/fairy_lettuce/20221220182346><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/f/fairy_lettuce/20221220/20221220182346.png alt=20221220182346></a><p>実際に $\boldsymbol{P&rsquo;}^{-1}$ の各成分が $\frac{-1}{N} \min(i,j)(N-\max(i,j))$ であることは証明できます。</p><details><summary><u><b>証明を展開する</b></u></summary>$\boldsymbol{P'}^{-1}$ の 第 $(i, j)$ 成分 ($i, j$ のいずれかが $0,N$) を $0$ と仮定すると $\frac{-1}{N} \min(i,j)(N-\max(i,j))$ の自然な拡張となるので、そうします。<p>$\boldsymbol{P&rsquo;}^{-1}\boldsymbol{P&rsquo;}$ の第 $(i,j)$ 成分を $c_{i,j}$ とおき ($1\le i,j\le N$)、これが $\delta_{i,j}$ に一致することを示します。ただし、$\delta_{i,j}$ はクロネッカーのデルタです。</p><p>$c_{i,j}=\frac{-1}{N} (\min(i-1,j)(N-\max(i-1,j))-2\min(i,j)(N-\max(i,j))+\min(i+1,j)(N-\max(i+1,j))$ と表せます。これは先においた仮定により成立します。</p><ol><li>$i=j$ のとき<br>$c_{i,j}=\frac{-1}{N} ( ( i-1)(N-i)-2i(N-i)+i(N-(i+1) )$ となり、これを展開して計算すると $c_{i,j}=1$。</li><li>$i\lt j$ のとき<br>$c_{i,j}=\frac{-1}{N} ( ( i-1)(N-j)-2i(N-j)+(i+1)(N-j ) )$ となり、これを展開して計算すると $c_{i,j}=0$。</li><li>$i\gt j$ のとき<br>対称性より自明。</li></ol><p>以上より、$\boldsymbol{P&rsquo;}^{-1}\boldsymbol{P&rsquo;}=\boldsymbol{I}$、つまり両者を掛けると単位行列になるので題意が示された。</p></details><p>これにより、$\boldsymbol{P&rsquo;}^{-1}$ が綺麗な形で計算できるので、累積和や Segment Tree などによって容易に $\boldsymbol{x&rsquo;}=\boldsymbol{P&rsquo;}^{-1}\boldsymbol{a&rsquo;}$ を求めることができます。</p><p>ただし、これによって求めた解は負の値が含まれている可能性があります。全ての操作を同じ回数だけ増やしても連立方程式の解となるので、最小値が負の値なら $x_i$ を $x_i-\min{x}$ に置き換えます。これが求めるべき最小値です。</p><p>また、解が存在しない条件は、$\sum A_i=0$ でない、もしくは求めた $\boldsymbol{x}$ の値が整数とならないことです。</p><h2 id=実装>実装</h2><details><summary><u><b>実装を展開する</b></u></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> Solve()
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> n = sr.ReadInt();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> a = sr.ReadLongArray(n);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (a.Sum() != <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				Console.WriteLine(-<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> seg1 = <span style=color:#66d9ef>new</span> Segtree&lt;<span style=color:#66d9ef>long</span>, Op&gt;(a.Select((p, i) =&gt; -p * (n - i - <span style=color:#ae81ff>1</span>)).ToArray());
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> seg2 = <span style=color:#66d9ef>new</span> Segtree&lt;<span style=color:#66d9ef>long</span>, Op&gt;(a.Select((p, i) =&gt; -p * (i + <span style=color:#ae81ff>1</span>)).ToArray());
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> x = <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>long</span>[n];
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; n - <span style=color:#ae81ff>1</span>; i++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				x[i] += (i + <span style=color:#ae81ff>1</span>) * seg1.Prod(i, n - <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>				x[i] += (n - <span style=color:#ae81ff>1</span> - i) * seg2.Prod(<span style=color:#ae81ff>0</span>, i);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (x[i] % n != <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					Console.WriteLine(-<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				x[i] /= n;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			x[n - <span style=color:#ae81ff>1</span>] = <span style=color:#ae81ff>2</span> * x[<span style=color:#ae81ff>0</span>] - x[<span style=color:#ae81ff>1</span>] + a[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (x[n - <span style=color:#ae81ff>1</span>] % n != <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				Console.WriteLine(-<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> min = Max(<span style=color:#ae81ff>0</span>, -x.Min());
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; n; i++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				x[i] += min;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			Console.WriteLine(x.Sum());
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>readonly</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Op</span> : ISegtreeOperator&lt;<span style=color:#66d9ef>long</span>&gt;
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> Operate(<span style=color:#66d9ef>long</span> x, <span style=color:#66d9ef>long</span> y) =&gt; x + y;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> Identity =&gt; <span style=color:#ae81ff>0L</span>;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div></details><p>ACコード: <a href=https://atcoder.jp/contests/arc129/submissions/37407234>https://atcoder.jp/contests/arc129/submissions/37407234</a></p><h2 id=感想>感想</h2><p>なんでこれ通るんですか？感のある解答でした。ちゃんと証明したのでスッキリしました。ところで $\boldsymbol{x}$ の値が整数とならないことってあるんですかね……。</p></section><section></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=author class="Box mb-3 mt-3 p-2 text-center"><a href=/about><img class=m-1 src=/icon-round.png alt=プロフィール画像 width=120 height=120></a><p class="text-emphasized f3">れたす</p><p>遊んだこと・学んだことをまとめる個人ブログ</p><a href=https://twitter.com/fairy_lettuce>Twitter</a></div><div id=toc class="Box Box--blue mb-3"><b>AtCoder Regular Contest 129 D - -1+2-1 解説 (エスパー→証明)</b><nav id=TableOfContents><ul><li><a href=#問題リンク>問題リンク</a></li><li><a href=#問題概要>問題概要</a></li><li><a href=#制約>制約</a></li><li><a href=#考察>考察</a></li><li><a href=#解法>解法</a></li><li><a href=#実装>実装</a></li><li><a href=#感想>感想</a></li></ul></nav></div><div><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-show-count=false>Tweet</a><script async src=https://platform.twitter.com/widgets.js></script>
<iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button&size=small&mobile_iframe=true&width=61&height=20&appId" width=61 height=20 style=border:none;overflow:hidden scrolling=no frameborder=0 allowtransparency=true allow=encrypted-media></iframe>
<a href=http://b.hatena.ne.jp/entry/ class=hatena-bookmark-button data-hatena-bookmark-layout=basic-label-counter data-hatena-bookmark-lang=ja title=このエントリーをはてなブックマークに追加><img src=https://b.st-hatena.com/images/entry-button/button-only@2x.png alt=このエントリーをはてなブックマークに追加 width=20 height=20 style=border:none></a><script type=text/javascript src=https://b.st-hatena.com/js/bookmark_button.js async></script>
<a data-pocket-label=pocket data-pocket-count=none class=pocket-btn data-lang=en></a><script type=text/javascript>!function(e,t){if(!e.getElementById(t)){var s,n=e.createElement("script");n.id=t,n.src="https://widgets.getpocket.com/v1/j/btn.js?v=1",s=e.getElementById(t),e.body.appendChild(n)}}(document,"pocket-btn-js")</script></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"><span class="text-small text-gray">©fairy-lettuce 2023 &#183;
Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</span></div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script></body></html>