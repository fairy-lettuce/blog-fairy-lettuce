<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ9N5F5QDD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QZ9N5F5QDD")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>AtCoder Regular Contest 114 C - Sequence Scores 解説 &ndash; Growth Record of Lettuce Farm: Extended
</title><meta name=description property="og:description" content="解説記事を書くのはかなりお久しぶりになってしまいました。 問題リンク https://atcoder.jp/contests/arc114/tasks/arc114_c 問題概要 以上 以下の整数からなる長さ の数列 に対して、 を以下のように定義します。 長さ の数列 があり、…|れたすのブログ"><meta name=apple-mobile-web-app-title content="Growth Record of Lettuce Farm: Extended"><link rel=icon href=https://blog.fairy-lettuce.com/favicon-64.png><link rel=apple-touch-icon href=https://blog.fairy-lettuce.com/apple-touch-icon.png><link rel=mask-icon size=any href=https://blog.fairy-lettuce.com/pinned-icon.svg><meta name=twitter:card content="summary"><meta name=twitter:site content="@fairy_lettuce"><meta name=twitter:creator content="@fairy_lettuce"><meta name=twitter:title content="AtCoder Regular Contest 114 C - Sequence Scores 解説 | Growth Record of Lettuce Farm: Extended"><meta name=twitter:description content="解説記事を書くのはかなりお久しぶりになってしまいました。 問題リンク https://atcoder.jp/contests/arc114/tasks/arc114_c 問題概要 以上 以下の整数からなる長さ の数列 に対して、 を以下のように定義します。 長さ の数列 があり、…|れたすのブログ"><meta name=twitter:image content="https://blog.fairy-lettuce.com/twitter-card.png"><link rel=stylesheet href=/assets/syntax.css><link rel=stylesheet href=/assets/primer-build.css><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/custom_style.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://blog.fairy-lettuce.com/>Growth Record of Lettuce Farm: Extended</a><div class=UnderlineNav-body><a class=UnderlineNav-item href=/about><i class='fa fa-about'></i>
<span>About</span>
</a><a class=UnderlineNav-item href=/diary><i class='fa fa-diary'></i>
<span>Diary</span>
</a><a class=UnderlineNav-item href=/cp><i class='fa fa-cp'></i>
<span>Competitive</span>
</a><a class=UnderlineNav-item href=/game><i class='fa fa-cp'></i>
<span>Game</span>
</a><a class=UnderlineNav-item href=/links><i class='fa fa-diary-old'></i>
<span>Links</span>
</a><a class=UnderlineNav-item href=https://github.com/fairy-lettuce><i class='fa fa-github'></i>
<span>GitHub</span></a></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">AtCoder Regular Contest 114 C - Sequence Scores 解説</div></div><div class=Subhead-description><a href=/categories/%E7%AB%B6%E3%83%97%E3%83%AD%E8%A7%A3%E8%AA%AC class=muted-link><span class="Label Label--gray-darker">競プロ解説</span>
</a><a href=/categories/atcoder class=muted-link><span class="Label Label--gray-darker">AtCoder</span>
</a><a href=/tags/competitive class=muted-link><span class="Label Label--gray">Competitive</span></a><div class=float-md-right><span title="Lastmod: 2021-03-19. Published at: 2021-03-19.">Published: 2021-03-19</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><p>解説記事を書くのはかなりお久しぶりになってしまいました。</p><h2 id=問題リンク>問題リンク</h2><p><a href=https://atcoder.jp/contests/arc114/tasks/arc114_c>https://atcoder.jp/contests/arc114/tasks/arc114_c</a></p><h2 id=問題概要>問題概要</h2><p>$1$ 以上 $M$ 以下の整数からなる長さ $N$ の数列 $A$ に対して、$f(A)$ を以下のように定義します。</p><ul><li><p>長さ $N$ の数列 $X$ があり、初め全ての要素は $0$ である。$f(A)$ を、次の操作を繰り返して $X$ を $A$ に等しくするために必要な最小の操作回数とする。</p><ul><li>$1\le l\le r\le N$ と $1\le v\le M$ を指定する。$1\le i\le r$ に対して $X_i$ を $\max(X_i,\ v)$ で置き換える。</li></ul></li></ul><p>全ての $A$ に対する $f(A)$ の和を $\bmod 998244353$ で求めてください。</p><h2 id=制約>制約</h2><ul><li>$1\le N,\ M\le 5000$</li></ul><h2 id=考察解法>考察・解法</h2><p>一見すると DP で解けそうに見えますが、直接数え上げが出来そうな雰囲気もします。DP は色々考えてもほとんど思い浮かばないので思い切って直接数え上げる方針でいきます。</p><p>最初に $f(A)$ を言い換えます。数列 $A$ のうち以下の条件を満たす要素 $A_i$ の個数を $s$ とすると、$f(A)=N-s$ です。</p><ul><li>ある $0\le j\lt i$ が存在し $A_j=A_i$ を満たす。また、この $j$ について、全ての $j\le k\lt i$ について $A_k \ge A_i$ を満たす。…… [条件 ★]</li></ul><p>これを満たす $A_j$ があるならば、$l=j,\ r=i,\ v=A_i$ として問題文の操作を行えば $A_i$ のぶんの操作を $A_j$ に押し付けることができます。そうでない要素については操作を行わないといけないので、そのような要素の個数を数え上げます。</p><p>さて、$A_i=a$ とします。$A_i=a$ を満たす数列 $A$ は $M^{N-1}$ 通りありますが、その中で [条件 ★] を満たすものの個数を数え上げます。</p><p>[条件 ★] の $A_j$ はある $A_i$ について複数個存在するかもしれませんが、その中でも右端のものは一意に定まります。よって $A_j$ を固定して、</p><ul><li>$A_j=A_i=a$ かつ、全ての $j\lt k\lt i$ について $A_k\gt a$ を満たしている。</li></ul><p>という条件を満たす数列 $A$ の個数を数え上げればよいです。これは、</p><p>$(M-a)^{i-j-1}\times M^{N-(i-j-1)-2}$</p><p>個です。ただし、$a=M$ となる場合のみ $j=i-1$ でないとならないので、$i=0$ のとき $0$ 個、そうでないとき $M^{N-2}$ 個となります (これは $0^0=1$ と定義すると元の式と一致します)。</p><p>よって、$A_i=a$ のときに [条件 ★] を満たす数列の個数は、($a\lt M$ であるとき)</p><p>$\displaystyle \sum_{j=0}^{i-1} (M-a)^{i-j-1}\times M^{N-(i-j-1)-2}$</p><p>$\displaystyle =M^{N-2}\sum_{j=0}^{i-1}\left(\frac{M-a}{M}\right)^{i-j-1}$</p><p>$\displaystyle =M^{N-2}\sum_{j=0}^{i-1}\left(\frac{M-a}{M}\right)^j$</p><p>$\displaystyle =M^{N-2}\frac{\left(\frac{M-a}{M}\right)^i-1}{\left(\frac{M-a}{M}\right)-1}$</p><p>$\displaystyle =M^{N-2}\frac{\left(\frac{M-a}{M}\right)^i-1}{-\frac{a}{M}}$</p><p>$\displaystyle =M^{N-i-1}\frac{M^i-(M-a)^i}{a}$</p><p>です。ちなみにこの変形は Wolfram|Alpha に投げても得られます。</p><p>$a=M$ とすると、$i\gt 0$ のとき</p><p>$\displaystyle M^{N-i-1}\frac{M^i-(M-a)^i}{a}=M^{N-2}$</p><p>、また $i=0$ のときも $0^0=1$ と定義すれば $0$ になることより、$a=M$ となる場合についてもこの式が成り立っていることが分かります。</p><p>この式に現れる変数は $i,\ a$ であり、それぞれ $0\le i\lt N,\ 1\le a\le M$ を独立に動きます。</p><p>$O(NM)$ はギリギリ間に合いそうなので、$i,\ a$ それぞれについてこの式の値を求め、その総和を求めればよいです。</p><h2 id=実装>実装</h2><p>この問題では制約が大きめであり、$O(NM)$ に何かしらの $\log$ がつくと実行時間制限に間に合わない可能性が高いです。</p><p>この問題で $\log$ が付きそうな計算といえば、$\bmod 998244353$ 上の累乗計算および除算です。これらは以下のようにして $\log$ を無視可能な実装にできます。</p><ul><li>累乗計算: 前計算する。底・指数それぞれ $5000$ 以下について前計算すれば十分。</li><li>除算: <code>for</code> 文を回す順番を $i,\ a$ の順番とし、$a$ で除算を行う項全ての総和をまとめて $1$ 回で除算する。</li></ul><details><summary><u><b>実装を展開する</b></u></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>		ModInt[][] pow;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Init()
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			pow = <span style=color:#66d9ef>new</span> ModInt[<span style=color:#ae81ff>5005</span>][];
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; <span style=color:#ae81ff>5005</span>; i++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				pow[i] = <span style=color:#66d9ef>new</span> ModInt[<span style=color:#ae81ff>5005</span>];
</span></span><span style=display:flex><span>				pow[i][<span style=color:#ae81ff>0</span>] = <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j = <span style=color:#ae81ff>1</span>; j &lt; <span style=color:#ae81ff>5005</span>; j++)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					pow[i][j] = pow[i][j - <span style=color:#ae81ff>1</span>] * i;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Solve()
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			Init();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> (n, m) = sr.ReadValue&lt;<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>&gt;();
</span></span><span style=display:flex><span>			ModInt ans = <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j = <span style=color:#ae81ff>1</span>; j &lt;= m; j++)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				ModInt sum = <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; n; i++)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#75715e>//ans += ((ModInt.Pow(m, i) - ModInt.Pow(m - j, i)) / j) * ModInt.Pow(m, n - i - 1);</span>
</span></span><span style=display:flex><span>					sum += ((pow[m][i] - pow[m - j][i])) * pow[m][n - i - <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				sum /= j;
</span></span><span style=display:flex><span>				ans += sum;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#75715e>//Console.WriteLine(ModInt.Pow(m, n) * n - ans);</span>
</span></span><span style=display:flex><span>			Console.WriteLine(pow[m][n] * n - ans);
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div></details><p>ACコード: <a href=https://atcoder.jp/contests/arc114/submissions/20947519>https://atcoder.jp/contests/arc114/submissions/20947519</a></p><h2 id=感想>感想</h2><p>数学ゲーだったので数式しかない文章になっちゃいました。読めるかな。</p><p>コンテスト中、定数倍で間に合わないの！？と思って焦って C++ を久々に書きました。しかし $\log$ を付けていると C++ でも通らず、$O(NM \log p)$ では通らないのではないかと思い始め更に総和を取る方向へと走ってしまいました<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。</p><p>結局 $\log$ を頑張って無くせば C++ はおろか C# でも AC できたというオチでした。解法は何もかも合っていたのにこのサボりのせいでコンテスト中の AC を逃し、冷えてしまいました。</p><p>ということで、改めて <b>$\log$ が落とせそうなときはサボらずちゃんと $\log$ を落とす</b>ことの大切さを学びました。<s>さては財宝やらなんやらで定数倍に苦しめられたとき結局 $\log$ が悪さしてたときに何も学んでないな？？？</s></p><p>ということで、今回の反省文でした。次回の反省文もご期待ください。<s>次はこういうポカじゃないといいな……</s></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>実装が下手で無限にバグらせていたので私が悪いのですが、ちゃんと総和を取れば $O(M\log N)$ でできますね。maspy さんの解説にもあります。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><section></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=author class="Box mb-3 mt-3 p-2 text-center"><a href=/about><img class=m-1 src=/icon-round.png alt=プロフィール画像 width=120 height=120></a><p class="text-emphasized f3">れたす</p><p>遊んだこと・学んだことをまとめる個人ブログ</p><a href=https://twitter.com/fairy_lettuce>Twitter</a></div><div id=toc class="Box Box--blue mb-3"><b>AtCoder Regular Contest 114 C - Sequence Scores 解説</b><nav id=TableOfContents><ul><li><a href=#問題リンク>問題リンク</a></li><li><a href=#問題概要>問題概要</a></li><li><a href=#制約>制約</a></li><li><a href=#考察解法>考察・解法</a></li><li><a href=#実装>実装</a></li><li><a href=#感想>感想</a></li></ul></nav></div><div><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-show-count=false>Tweet</a><script async src=https://platform.twitter.com/widgets.js></script>
<iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button&size=small&mobile_iframe=true&width=61&height=20&appId" width=61 height=20 style=border:none;overflow:hidden scrolling=no frameborder=0 allowtransparency=true allow=encrypted-media></iframe>
<a href=http://b.hatena.ne.jp/entry/ class=hatena-bookmark-button data-hatena-bookmark-layout=basic-label-counter data-hatena-bookmark-lang=ja title=このエントリーをはてなブックマークに追加><img src=https://b.st-hatena.com/images/entry-button/button-only@2x.png alt=このエントリーをはてなブックマークに追加 width=20 height=20 style=border:none></a><script type=text/javascript src=https://b.st-hatena.com/js/bookmark_button.js async></script>
<a data-pocket-label=pocket data-pocket-count=none class=pocket-btn data-lang=en></a><script type=text/javascript>!function(e,t){if(!e.getElementById(t)){var s,n=e.createElement("script");n.id=t,n.src="https://widgets.getpocket.com/v1/j/btn.js?v=1",s=e.getElementById(t),e.body.appendChild(n)}}(document,"pocket-btn-js")</script></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"><span class="text-small text-gray">©fairy-lettuce 2023 &#183;
Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</span></div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script></body></html>